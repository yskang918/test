<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ì´ë¯¸ì§€ ì¸ì‹ ì„¼í„°</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* ë³€ìˆ˜ ì„¤ì • (ë‹¤í¬ ëª¨ë“œ ìœ ì§€) */
        :root {
            --bg-color: #1e1e2f; 
            --card-color: #27293d;
            --text-light: #f0f0f0;
            --primary-gradient: linear-gradient(45deg, #a77dff, #6a5acd);
            --primary-color: #6a5acd;
            --highlight-color: #ff9f43; /* ê°•ì¡°ìƒ‰ ì¶”ê°€ */
            --shadow-dark: rgba(0, 0, 0, 0.4);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            margin: 0;
            min-height: 100vh;
        }
        
        h1 {
            font-weight: 700;
            margin-bottom: 40px;
            color: var(--text-light);
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(106, 90, 205, 0.5); /* ì€ì€í•œ ë„¤ì˜¨ íš¨ê³¼ */
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ: ì›¹ìº ê³¼ ë²„íŠ¼ì„ ì¤‘ì•™ì— í¬ê²Œ ë°°ì¹˜ */
        .main-recognition-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 500px; /* ì „ì²´ ì•±ì˜ ìµœëŒ€ ë„ˆë¹„ë¥¼ ë„“ê²Œ ì„¤ì • */
            margin-bottom: 40px;
        }

        /* ì›¹ìº  ì»¨í…Œì´ë„ˆ: ê°€ì¥ í° ë©´ì ì„ ì°¨ì§€í•˜ë„ë¡ ì„¤ì • */
        #webcam-container {
            width: 100%; 
            padding-bottom: 100%; /* 1:1 ë¹„ìœ¨ ìœ ì§€ë¥¼ ìœ„í•œ íŠ¸ë¦­ */
            position: relative;
            border: 5px solid var(--primary-color);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 30px var(--shadow-dark);
            margin-bottom: 30px;
        }
        #webcam-container canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover; /* ìº”ë²„ìŠ¤ê°€ ì»¨í…Œì´ë„ˆë¥¼ ê°€ë“ ì±„ìš°ë„ë¡ */
        }

        /* ì‹œì‘ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ì›¹ìº  ì•„ë˜) */
        #start-button {
            padding: 15px 40px; /* ë²„íŠ¼ í¬ê¸° í‚¤ì›€ */
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-light);
            background: var(--primary-gradient);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 6px 20px var(--shadow-dark);
            transition: all 0.3s ease;
            width: 80%; /* ì¤‘ì•™ì— ë„“ê²Œ ë°°ì¹˜ */
        }
        #start-button:hover {
            transform: translateY(-3px);
        }
        #start-button:disabled {
            background: gray;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* ì˜ˆì¸¡ ê²°ê³¼ ì»¨í…Œì´ë„ˆ (ì›¹ìº  ì•„ë˜, ë” ë„“ì€ ì˜ì—­ ì‚¬ìš©) */
        #label-container {
            width: 100%;
            max-width: 500px;
            padding: 25px;
            background-color: var(--card-color);
            border-radius: 15px;
            box-shadow: 0 4px 10px var(--shadow-dark);
        }

        /* ê° ì˜ˆì¸¡ í•­ëª© ìŠ¤íƒ€ì¼ */
        .prediction-item {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
            padding: 10px;
            border-bottom: 1px solid rgba(240, 240, 240, 0.1);
            transition: all 0.2s ease;
        }
        .prediction-item.highlighted {
            background-color: rgba(255, 159, 67, 0.1); /* ê°•ì¡° ë°°ê²½ìƒ‰ */
            border-left: 5px solid var(--highlight-color);
            border-radius: 5px;
            padding-left: 15px;
        }
        .prediction-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .class-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary-color);
            font-size: 1rem;
        }
        .highlighted .class-name {
            color: var(--highlight-color);
            font-size: 1.1rem;
        }

        .progress-bar {
            height: 12px;
            background-color: #3b3d57; 
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-gradient);
            transition: width 0.3s ease-out; 
        }
        .highlighted .progress-fill {
            background: linear-gradient(45deg, var(--highlight-color), #ffc048); /* ê°•ì¡° ê·¸ë¼ë°ì´ì…˜ */
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 550px) {
            h1 {
                font-size: 1.5rem;
                margin-bottom: 20px;
            }
            .main-recognition-area {
                margin-bottom: 20px;
            }
            #start-button {
                width: 100%;
                padding: 12px 20px;
            }
            #label-container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <h1>AI ë¹„ì „ ì„¼í„°: ì´ë¯¸ì§€ ì¸ì‹</h1>
    
    <div class="main-recognition-area">
        <div id="webcam-container"></div>
        <button type="button" id="start-button" onclick="init()">ëª¨ë¸ ì‹œì‘ ë° ì›¹ìº  í™œì„±í™”</button> 
    </div>
    
    <div id="label-container">
        <div style="text-align: center; color: gray;">
            ğŸ‘† ìœ„ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¹´ë©”ë¼ë¥¼ ì¼œê³  ì¸ì‹ì„ ì‹œì‘í•˜ì„¸ìš”.
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <script type="text/javascript">
        const URL = "./my_model/"; 
        let model, webcam, labelContainer, maxPredictions;
        let isModelLoaded = false;

        async function init() {
            const startButton = document.getElementById('start-button');
            startButton.disabled = true;
            startButton.textContent = "ëª¨ë¸ ë¡œë”© ì¤‘...";

            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();
            isModelLoaded = true;

            const flip = true; 
            // ì›¹ìº  í¬ê¸°ë¥¼ ì»¨í…Œì´ë„ˆ í¬ê¸°ì— ë§ì¶° ë™ì ìœ¼ë¡œ ì¡°ì •
            const container = document.getElementById('webcam-container');
            const size = container.offsetWidth; 
            webcam = new tmImage.Webcam(size, size, flip); 
            
            await webcam.setup();
            await webcam.play();
            window.requestAnimationFrame(loop);

            container.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì œê±°
            container.appendChild(webcam.canvas);
            
            labelContainer = document.getElementById("label-container");
            labelContainer.innerHTML = '';

            // ì˜ˆì¸¡ í•­ëª©ì„ ì‹œê°í™” êµ¬ì¡°ë¡œ ìƒì„±
            for (let i = 0; i < maxPredictions; i++) { 
                const item = document.createElement("div");
                item.classList.add('prediction-item');
                
                const nameDiv = document.createElement("div");
                nameDiv.classList.add('class-name');
                item.appendChild(nameDiv);
                
                const progressBar = document.createElement("div");
                progressBar.classList.add('progress-bar');
                const progressFill = document.createElement("div");
                progressFill.classList.add('progress-fill');
                progressBar.appendChild(progressFill);
                item.appendChild(progressBar);

                labelContainer.appendChild(item);
            }
            
            startButton.textContent = "AI ì¸ì‹ í™œì„±í™”ë¨";
        }

        async function loop() {
            if (webcam && isModelLoaded) {
                webcam.update(); 
                await predict();
            }
            window.requestAnimationFrame(loop);
        }

        async function predict() {
            const prediction = await model.predict(webcam.canvas);
            let highestProb = -1;
            let highestIndex = -1;
            
            // 1. ìµœê³  í™•ë¥  í•­ëª© ì°¾ê¸°
            for(let i = 0; i < maxPredictions; i++) {
                if (prediction[i].probability > highestProb) {
                    highestProb = prediction[i].probability;
                    highestIndex = i;
                }
            }

            // 2. DOM ì—…ë°ì´íŠ¸ ë° í•˜ì´ë¼ì´íŠ¸ ì ìš©
            for (let i = 0; i < maxPredictions; i++) {
                const item = labelContainer.childNodes[i];
                const classNameDiv = item.querySelector('.class-name');
                const progressFillDiv = item.querySelector('.progress-fill');
                
                const probability = prediction[i].probability;
                const probabilityPercent = (probability * 100).toFixed(1);
                
                // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                classNameDiv.innerHTML = `${prediction[i].className} (${probabilityPercent}%)`;
                
                // ë§‰ëŒ€ ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
                progressFillDiv.style.width = probabilityPercent + '%';

                // â­ï¸ ë°”ì´ë¸Œ ì½”ë”© ìˆ˜ì •: ìµœê³  í™•ë¥  í•­ëª© ê°•ì¡°
                if (i === highestIndex) {
                    item.classList.add('highlighted');
                } else {
                    item.classList.remove('highlighted');
                }
            }
        }
    </script>
</body>
</html>
